<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<canvas id="canvas"></canvas>
</body>
</html>
<script src="./adun.js"></script>
<script>
    var sprite = new ADUN.Node();
    console.log(sprite._dirty)
    sprite.x = 12;
    console.log(sprite._x)
    console.log(sprite._dirty)

    var Matrix = ADUN.Matrix =  ADUN.Class({
        init: function() {
            this.reset();
        },

        reset: function() {
            this.stack = [];
            this.stack.push([ 1, 0, 0, 1, 0, 0]);
        },

        makeTransformMatrix: function(node, dest) {
            var x, y, width, height, rotation, scaleX, scaleY, theta, tmpcos, tmpsin, w, h, a, b, c, d, tx, ty;

            x = node._x;
            y = node._y;
            width = node.width || 0;
            height = node.height || 0;
            rotation = node._rotation || 0;
            scaleX = ADUN.isNumber(node._scaleX) ? node._scaleX : 1;       // (|k| > 1) => x -> k배 확대,  (k < 0) => y축 대칭
            scaleY = ADUN.isNumber(node._scaleY) ? node._scaleY : 1;       // (|k| > 1) => y -> k백 확대,  (k < 0) => x축 대칭
            theta = rotation * Math.PI / 180;
            tmpcos = Math.cos(theta);                           // Math.cos(0) == 1
            tmpsin = Math.sin(theta);                           // Math.sin(0) == 0
            w = ADUN.isNumber(node._originX) ? node._originX : (width / 2);
            h = ADUN.isNumber(node._originY) ? node._originY : (height / 2);

            a = scaleX * tmpcos;
            b = scaleX * tmpsin;
            c = scaleY * tmpsin;
            d = scaleY * tmpcos;

            dest[0] = a;
            dest[1] = b;    // 시계 방향 회전
            dest[2] = -c;   // 시계 방향 회전
            dest[3] = d;
            dest[4] = (-a * w + c * x + w);
            dest[5] = (-b * w + d * y + h);
        },

        multiply: function(m1, m2, dest) {

            var a11 = m1[0], a12 = m1[1], adx = m1[4];
            var a21 = m1[2], a22 = m1[3], ady = m1[5];

            var b11 = m2[0], b12 = m2[1], bdx = m2[4];
            var b21 = m2[2], b22 = m2[3], bdy = m2[5];

            dest[0] = a11 * b11 + a12 * b21;
            dest[1] = a11 * b12 + a12 + b22;
            dest[2] = a21 * b11 + a22 * b21;
            dest[3] = a21 * b12 + a22 * b22;
            dest[4] = adx;
        }
    })
</script>